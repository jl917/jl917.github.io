"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["8857"],{21921:function(e,n,r){r.r(n);var t=r(85893),s=r(50065);function o(e){let n=Object.assign({h1:"h1",a:"a",h3:"h3",ul:"ul",li:"li",pre:"pre",code:"code",p:"p"},(0,s.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"indexeddb",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#indexeddb",children:"#"}),"IndexedDB"]}),"\n",(0,t.jsxs)(n.h3,{id:"\u7279\u70B9",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u7279\u70B9",children:"#"}),"\u7279\u70B9"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u952E\u503C\u5BF9\u50A8\u5B58\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u5F02\u6B65"}),"\n",(0,t.jsx)(n.li,{children:"\u652F\u6301\u4E8B\u7269(transaction)"}),"\n",(0,t.jsx)(n.li,{children:"\u540C\u6E90\u9650\u5236"}),"\n",(0,t.jsx)(n.li,{children:"\u50A8\u5B58\u7A7A\u95F4\u5927"}),"\n",(0,t.jsx)(n.li,{children:"\u652F\u6301\u4E8C\u8FDB\u5236"}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"\u57FA\u672C\u6982\u5FF5",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u57FA\u672C\u6982\u5FF5",children:"#"}),"\u57FA\u672C\u6982\u5FF5"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6570\u636E\u5E93\uFF1AIDBDatabase \u5BF9\u8C61"}),"\n",(0,t.jsx)(n.li,{children:"\u5BF9\u8C61\u4ED3\u5E93\uFF1AIDBObjectStore \u5BF9\u8C61"}),"\n",(0,t.jsx)(n.li,{children:"\u7D22\u5F15\uFF1A IDBIndex \u5BF9\u8C61"}),"\n",(0,t.jsx)(n.li,{children:"\u4E8B\u52A1\uFF1A IDBTransaction \u5BF9\u8C61"}),"\n",(0,t.jsx)(n.li,{children:"\u64CD\u4F5C\u8BF7\u6C42\uFF1AIDBRequest \u5BF9\u8C61"}),"\n",(0,t.jsx)(n.li,{children:"\u6307\u9488\uFF1A IDBCursor \u5BF9\u8C61"}),"\n",(0,t.jsx)(n.li,{children:"\u4E3B\u952E\u96C6\u5408\uFF1AIDBKeyRange \u5BF9\u8C61"}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"\u6253\u5F00\u6570\u636E\u5E93",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u6253\u5F00\u6570\u636E\u5E93",children:"#"}),"\u6253\u5F00\u6570\u636E\u5E93"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",meta:"",children:'const request = window.indexedDB.open("dbname", 1);\n// error\u4E8B\u4EF6\u8868\u793A\u6253\u5F00\u6570\u636E\u5E93\u5931\u8D25\u3002\nrequest.onerror = function (event) {\n  console.log("\u6570\u636E\u5E93\u6253\u5F00\u62A5\u9519");\n};\n// success\u4E8B\u4EF6\u8868\u793A\u6210\u529F\u6253\u5F00\u6570\u636E\u5E93\u3002\nrequest.onsuccess = function (event) {\n  console.log(request.result);\n  console.log("\u6570\u636E\u5E93\u6253\u5F00\u6210\u529F");\n};\n// \u5982\u679C\u6307\u5B9A\u7684\u7248\u672C\u53F7\uFF0C\u5927\u4E8E\u6570\u636E\u5E93\u7684\u5B9E\u9645\u7248\u672C\u53F7\uFF0C\u5C31\u4F1A\u53D1\u751F\u6570\u636E\u5E93\u5347\u7EA7\u4E8B\u4EF6upgradeneeded\u3002\nrequest.onupgradeneeded = function (event) {\n  console.log(event.target.result);\n};\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"\u65B0\u5EFA\u6570\u636E\u5E93",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u65B0\u5EFA\u6570\u636E\u5E93",children:"#"}),"\u65B0\u5EFA\u6570\u636E\u5E93"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",meta:"",children:'request.onupgradeneeded = function (event) {\n  const db = event.target.result;\n  const objectStore = db.createObjectStore("person", { keyPath: "id" });\n\n  // \u81EA\u52A8\u751F\u6210\u4E3B\u952E\n  // const objectStore = db.createObjectStore(\'person\', { autoIncrement: true });\n\n  // \u521B\u5EFA\u7D22\u5F15\n  objectStore.createIndex("name", "name", { unique: false });\n  objectStore.createIndex("email", "email", { unique: true });\n};\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"\u65B0\u589E\u6570\u636E",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u65B0\u589E\u6570\u636E",children:"#"}),"\u65B0\u589E\u6570\u636E"]}),"\n",(0,t.jsx)(n.p,{children:"\u901A\u8FC7 objectStore \u5BF9\u8C61\u7684 add()\u65B9\u6CD5\uFF0C\u5411\u8868\u683C\u5199\u5165\u4E00\u6761\u8BB0\u5F55\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",meta:"",children:'function add() {\n  var request = db\n    .transaction(["person"], "readwrite")\n    .objectStore("person")\n    .add({ id: 1, name: "\u5F20\u4E09", age: 24, email: "zhangsan@example.com" });\n\n  request.onsuccess = function (event) {\n    console.log("\u6570\u636E\u5199\u5165\u6210\u529F");\n  };\n\n  request.onerror = function (event) {\n    console.log("\u6570\u636E\u5199\u5165\u5931\u8D25");\n  };\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"\u8BFB\u53D6\u6570\u636E",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u8BFB\u53D6\u6570\u636E",children:"#"}),"\u8BFB\u53D6\u6570\u636E"]}),"\n",(0,t.jsx)(n.p,{children:"\u8BFB\u53D6\u6570\u636E\u4E5F\u662F\u901A\u8FC7\u4E8B\u52A1\u5B8C\u6210\u3002 objectStore.get()\u65B9\u6CD5\u7528\u4E8E\u8BFB\u53D6\u6570\u636E\uFF0C\u53C2\u6570\u662F\u4E3B\u952E\u7684\u503C\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",meta:"",children:'function read() {\n  var transaction = db.transaction(["person"]);\n  var objectStore = transaction.objectStore("person");\n  var request = objectStore.get(1);\n\n  request.onerror = function (event) {\n    console.log("\u4E8B\u52A1\u5931\u8D25");\n  };\n\n  request.onsuccess = function (event) {\n    if (request.result) {\n      console.log(request.result);\n    } else {\n      console.log("\u672A\u83B7\u5F97\u6570\u636E\u8BB0\u5F55");\n    }\n  };\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"\u904D\u5386\u6570\u636E",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u904D\u5386\u6570\u636E",children:"#"}),"\u904D\u5386\u6570\u636E"]}),"\n",(0,t.jsx)(n.p,{children:"\u65B0\u5EFA\u6307\u9488\u5BF9\u8C61\u7684 openCursor()\u65B9\u6CD5\u662F\u4E00\u4E2A\u5F02\u6B65\u64CD\u4F5C\uFF0C\u6240\u4EE5\u8981\u76D1\u542C success \u4E8B\u4EF6\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",meta:"",children:'function readAll() {\n  var objectStore = db.transaction("person").objectStore("person");\n\n  objectStore.openCursor().onsuccess = function (event) {\n    var cursor = event.target.result;\n\n    if (cursor) {\n      console.log(cursor);\n      cursor.continue();\n    } else {\n      console.log("\u6CA1\u6709\u66F4\u591A\u6570\u636E\u4E86\uFF01");\n    }\n  };\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"\u66F4\u65B0\u6570\u636E",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u66F4\u65B0\u6570\u636E",children:"#"}),"\u66F4\u65B0\u6570\u636E"]}),"\n",(0,t.jsx)(n.p,{children:"put()\u65B9\u6CD5\u81EA\u52A8\u66F4\u65B0\u4E86\u4E3B\u952E\u4E3A 1 \u7684\u8BB0\u5F55\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",meta:"",children:'function update() {\n  var request = db\n    .transaction(["person"], "readwrite")\n    .objectStore("person")\n    .put({ id: 1, name: "\u674E\u56DB", age: 35, email: "lisi@example.com" });\n\n  request.onsuccess = function (event) {\n    console.log("\u6570\u636E\u66F4\u65B0\u6210\u529F");\n  };\n\n  request.onerror = function (event) {\n    console.log("\u6570\u636E\u66F4\u65B0\u5931\u8D25");\n  };\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"\u5220\u9664\u6570\u636E",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u5220\u9664\u6570\u636E",children:"#"}),"\u5220\u9664\u6570\u636E"]}),"\n",(0,t.jsx)(n.p,{children:"IDBObjectStore.delete()\u65B9\u6CD5\u7528\u4E8E\u5220\u9664\u8BB0\u5F55\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",meta:"",children:'function remove() {\n  var request = db.transaction(["person"], "readwrite").objectStore("person").delete(1);\n\n  request.onsuccess = function (event) {\n    console.log("\u6570\u636E\u5220\u9664\u6210\u529F");\n  };\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"\u4F7F\u7528\u7D22\u5F15",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4F7F\u7528\u7D22\u5F15",children:"#"}),"\u4F7F\u7528\u7D22\u5F15"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",meta:"",children:'var transaction = db.transaction(["person"], "readonly");\nvar store = transaction.objectStore("person");\nvar index = store.index("name");\nvar request = index.get("\u674E\u56DB");\n\nrequest.onsuccess = function (e) {\n  var result = e.target.result;\n  if (result) {\n    // ...\n  } else {\n    // ...\n  }\n};\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"html",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#html",children:"#"}),"html"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",meta:"",children:'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="utf-8" />\n  </head>\n\n  <body>\n    <div id="app">\n      <button class="add">add</button>\n      <button class="get">get</button>\n      <button class="getall">getall</button>\n\n      <button class="put">put</button>\n\n      <button class="del">del</button>\n    </div>\n    <script src="https://code.jquery.com/jquery-3.5.0.min.js"><\/script>\n    <script>\n      $(function () {\n        let db;\n\n        const request = window.indexedDB.open("dbname", 2);\n        // error\u4E8B\u4EF6\u8868\u793A\u6253\u5F00\u6570\u636E\u5E93\u5931\u8D25\u3002\n        request.onerror = function (event) {\n          console.log("\u6570\u636E\u5E93\u6253\u5F00\u62A5\u9519");\n        };\n        // success\u4E8B\u4EF6\u8868\u793A\u6210\u529F\u6253\u5F00\u6570\u636E\u5E93\u3002\n        request.onsuccess = function (event) {\n          db = request.result;\n          console.log(request.result);\n          console.log("\u6570\u636E\u5E93\u6253\u5F00\u6210\u529F");\n        };\n        // \u5982\u679C\u6307\u5B9A\u7684\u7248\u672C\u53F7\uFF0C\u5927\u4E8E\u6570\u636E\u5E93\u7684\u5B9E\u9645\u7248\u672C\u53F7\uFF0C\u5C31\u4F1A\u53D1\u751F\u6570\u636E\u5E93\u5347\u7EA7\u4E8B\u4EF6upgradeneeded\u3002\n        request.onupgradeneeded = function (event) {\n          console.log(event.target.result);\n          db = event.target.result;\n          if (!db.objectStoreNames.contains("person")) {\n            const objectStore = db.createObjectStore("person", { keyPath: "id" });\n            objectStore.createIndex("name", "name", { unique: false });\n            objectStore.createIndex("email", "email", { unique: true });\n          }\n          console.log(111);\n        };\n\n        $(".add").click(function () {\n          let req = db\n            .transaction(["person"], "readwrite")\n            .objectStore("person")\n            .add({ id: new Date().getTime(), name: "\u5F20\u4E09", age: 24, email: `${new Date().getTime()}+a@.com` });\n\n          req.onsuccess = function (event) {\n            console.log("\u6570\u636E\u5199\u5165\u6210\u529F");\n          };\n\n          req.onerror = function (event) {\n            console.log("\u6570\u636E\u5199\u5165\u5931\u8D25");\n          };\n        });\n\n        $(".get").click(function () {\n          var transaction = db.transaction(["person"]);\n          var objectStore = transaction.objectStore("person");\n          var req = objectStore.get(1);\n\n          req.onerror = function (event) {\n            console.log("\u4E8B\u52A1\u5931\u8D25");\n          };\n\n          req.onsuccess = function (event) {\n            if (req.result) {\n              console.log(req.result);\n            } else {\n              console.log("\u672A\u83B7\u5F97\u6570\u636E\u8BB0\u5F55");\n            }\n          };\n        });\n\n        $(".getall").click(function () {\n          var objectStore = db.transaction(["person"], "readwrite").objectStore("person");\n\n          objectStore.openCursor().onsuccess = function (event) {\n            var cursor = event.target.result;\n\n            if (cursor) {\n              console.log(cursor);\n              cursor.continue();\n            } else {\n              console.log("\u6CA1\u6709\u66F4\u591A\u6570\u636E\u4E86\uFF01");\n            }\n          };\n        });\n\n        $(".put").click(function () {\n          var req = db.transaction(["person"], "readwrite").objectStore("person").put({ id: 1, name: "\u674E\u56DB" });\n\n          req.onsuccess = function (event) {\n            console.log("\u6570\u636E\u66F4\u65B0\u6210\u529F");\n          };\n\n          req.onerror = function (event) {\n            console.log("\u6570\u636E\u66F4\u65B0\u5931\u8D25");\n          };\n        });\n\n        $(".del").click(function () {\n          var req = db.transaction(["person"], "readwrite").objectStore("person").delete(1587451687741);\n\n          req.onsuccess = function (event) {\n            console.log("\u6570\u636E\u5220\u9664\u6210\u529F");\n          };\n        });\n      });\n    <\/script>\n  </body>\n</html>\n'})})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(o,e)})):o(e)}n.default=c,c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["web%2Fhtml%2FindexedDB.md"]={toc:[{id:"\u7279\u70B9",text:"\u7279\u70B9",depth:3},{id:"\u57FA\u672C\u6982\u5FF5",text:"\u57FA\u672C\u6982\u5FF5",depth:3},{id:"\u6253\u5F00\u6570\u636E\u5E93",text:"\u6253\u5F00\u6570\u636E\u5E93",depth:3},{id:"\u65B0\u5EFA\u6570\u636E\u5E93",text:"\u65B0\u5EFA\u6570\u636E\u5E93",depth:3},{id:"\u65B0\u589E\u6570\u636E",text:"\u65B0\u589E\u6570\u636E",depth:3},{id:"\u8BFB\u53D6\u6570\u636E",text:"\u8BFB\u53D6\u6570\u636E",depth:3},{id:"\u904D\u5386\u6570\u636E",text:"\u904D\u5386\u6570\u636E",depth:3},{id:"\u66F4\u65B0\u6570\u636E",text:"\u66F4\u65B0\u6570\u636E",depth:3},{id:"\u5220\u9664\u6570\u636E",text:"\u5220\u9664\u6570\u636E",depth:3},{id:"\u4F7F\u7528\u7D22\u5F15",text:"\u4F7F\u7528\u7D22\u5F15",depth:3},{id:"html",text:"html",depth:3}],title:"IndexedDB",frontmatter:{}}}}]);